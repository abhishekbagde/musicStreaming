(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[635],{2836:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/broadcast",function(){return s(3377)}])},3377:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return a}});var r=s(5893),l=s(7294),o=s(1343),n=s(4160);function a(){let[e,t]=(0,l.useState)(""),[s,a]=(0,l.useState)(null),[i,c]=(0,l.useState)([]),[d,u]=(0,l.useState)([]),[x,m]=(0,l.useState)(""),[g,p]=(0,l.useState)(""),[h,b]=(0,l.useState)([]),[f,v]=(0,l.useState)([]),[j,N]=(0,l.useState)(null),[y,w]=(0,l.useState)(""),[D,S]=(0,l.useState)(!1),[C,W]=(0,l.useState)(!1),k=(0,l.useRef)(null),I=(0,l.useRef)(null),A=()=>{var e;null===(e=k.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})};(0,l.useEffect)(()=>(o.W.on("room:created",e=>{a(e.roomId),w(""),console.log("✅ Room created:",e.roomId),c([{userId:o.W.id||"host",username:"You (Host)",isHost:!0}])}),o.W.on("participants:list",e=>{var t;c(e.participants||[]),console.log("\uD83D\uDC65 Participants:",(null===(t=e.participants)||void 0===t?void 0:t.length)||0)}),o.W.on("user:joined",e=>{c(t=>t.some(t=>t.userId===e.userId)?t:(console.log("➕ User joined:",e.username),[...t,{userId:e.userId,username:e.username,isHost:e.isHost||!1}]))}),o.W.on("user:left",e=>{console.log("➖ User left:",e.userId),c(t=>t.filter(t=>t.userId!==e.userId))}),o.W.on("playlist:update",e=>{var t;if(v(e.queue||[]),N(e.currentSong||null),console.log("\uD83C\uDFB5 Queue updated:",(null===(t=e.queue)||void 0===t?void 0:t.length)||0),e.currentSong&&e.playing&&I.current){let t=n.x.getAudio(e.currentSong.url);I.current.src=t,I.current.play().catch(e=>{console.error("Error playing audio:",e)}),W(!0)}}),o.W.on("chat:message",e=>{u(t=>[...t,e]),A()}),o.W.on("error",e=>{w(e.message),console.error("❌ Error:",e.message)}),()=>{o.W.off("room:created"),o.W.off("participants:list"),o.W.off("user:joined"),o.W.off("user:left"),o.W.off("playlist:update"),o.W.off("chat:message"),o.W.off("error")}),[]),(0,l.useEffect)(()=>{let e=i.find(e=>e.userId===(o.W.id||"host"));S(!!(null==e?void 0:e.isHost))},[i]);let _=async e=>{if(e.preventDefault(),g.trim())try{let e=await n.x.search(g);b(e.results||[])}catch(e){b([]),w("YouTube search failed"),console.error("Search error:",e)}},E=e=>{s&&(o.W.emit("song:add",{roomId:s,song:e}),console.log("➕ Song added:",e.title))},R=e=>{s&&D&&(o.W.emit("song:remove",{roomId:s,songId:e}),console.log("➖ Song removed:",e))};return s?(0,r.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-purple-600 via-purple-700 to-indigo-800 p-4",children:[(0,r.jsx)("audio",{ref:I,crossOrigin:"anonymous",onEnded:()=>W(!1)}),(0,r.jsxs)("div",{className:"max-w-5xl mx-auto grid md:grid-cols-3 gap-6",children:[(0,r.jsxs)("div",{className:"md:col-span-2 space-y-6",children:[(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"\uD83C\uDFB5 Music Queue"}),(0,r.jsx)("form",{onSubmit:_,className:"mb-6",children:(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("input",{type:"text",value:g,onChange:e=>p(e.target.value),placeholder:"Search YouTube...",className:"flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"}),(0,r.jsx)("button",{type:"submit",className:"bg-purple-600 text-white px-6 py-3 rounded-lg hover:bg-purple-700 font-bold transition-colors",children:"\uD83D\uDD0D Search"})]})}),h.length>0&&(0,r.jsxs)("div",{className:"mb-6 border border-gray-200 rounded-lg overflow-hidden",children:[(0,r.jsx)("div",{className:"bg-gray-50 px-4 py-2 border-b font-semibold text-sm",children:"Search Results"}),(0,r.jsx)("ul",{className:"max-h-72 overflow-y-auto",children:h.map(e=>(0,r.jsx)("li",{className:"border-b border-gray-100 hover:bg-gray-50 transition-colors p-3",children:(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[e.thumbnail&&(0,r.jsx)("img",{src:e.thumbnail,alt:"thumbnail",className:"w-14 h-14 rounded object-cover flex-shrink-0"}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsx)("div",{className:"font-semibold text-gray-800 truncate",children:e.title}),(0,r.jsx)("div",{className:"text-sm text-gray-500 truncate",children:e.author}),(0,r.jsx)("div",{className:"text-xs text-gray-400",children:e.duration||"N/A"})]}),(0,r.jsx)("button",{onClick:()=>{E(e),b([])},className:"bg-green-500 text-white px-3 py-2 rounded hover:bg-green-600 text-sm font-bold flex-shrink-0 whitespace-nowrap",children:"+ Add"})]})},e.id))})]}),f.length>0&&(0,r.jsx)("div",{className:"mb-6",children:(0,r.jsxs)("div",{className:"bg-gradient-to-r from-purple-500 to-indigo-600 rounded-lg p-6 text-white",children:[(0,r.jsx)("div",{className:"text-sm font-semibold mb-2",children:"NOW PLAYING"}),(0,r.jsx)("div",{className:"text-2xl font-bold mb-2 truncate",children:f[0].title}),(0,r.jsx)("div",{className:"text-purple-100 mb-4 truncate",children:f[0].author}),D&&(0,r.jsxs)("div",{className:"flex gap-3",children:[(0,r.jsx)("button",{onClick:()=>{s&&D&&(o.W.emit("song:play",{roomId:s}),console.log("▶️ Playing next song"))},className:"bg-white text-purple-600 px-6 py-2 rounded font-bold hover:bg-gray-100 transition-colors flex-1",children:"▶️ Play"}),(0,r.jsx)("button",{onClick:()=>{s&&D&&(o.W.emit("song:skip",{roomId:s}),console.log("⏭️ Skipped to next song"))},className:"bg-purple-700 text-white px-6 py-2 rounded font-bold hover:bg-purple-800 transition-colors flex-1",children:"⏭️ Skip"})]})]})}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("h3",{className:"font-bold text-lg text-gray-800 mb-3",children:["Queue (",f.length,")"]}),0===f.length?(0,r.jsxs)("div",{className:"bg-gray-50 rounded-lg p-8 text-center text-gray-500",children:[(0,r.jsx)("div",{className:"text-4xl mb-2",children:"\uD83C\uDFB5"}),(0,r.jsx)("p",{children:"No songs in queue yet. Search and add some!"})]}):(0,r.jsx)("div",{className:"space-y-2",children:f.map((e,t)=>(0,r.jsxs)("div",{className:"flex items-center gap-3 p-3 rounded-lg transition-colors ".concat(0===t?"bg-purple-100 border-2 border-purple-500":"bg-gray-50 hover:bg-gray-100"),children:[(0,r.jsx)("div",{className:"text-lg font-bold w-8 text-center",children:0===t?"▶️":t}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsx)("div",{className:"font-semibold text-gray-800 truncate",children:e.title}),(0,r.jsx)("div",{className:"text-sm text-gray-500 truncate",children:e.author})]}),(0,r.jsx)("div",{className:"text-sm text-gray-400 flex-shrink-0",children:e.duration||"N/A"}),D&&(0,r.jsx)("button",{onClick:()=>R(e.id),className:"bg-red-500 hover:bg-red-600 text-white p-2 rounded transition-colors flex-shrink-0",title:"Remove",children:"✕"})]},e.id))})]})]}),(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-gray-800",children:"\uD83C\uDFA4 Room"}),(0,r.jsxs)("div",{className:"text-sm text-gray-500",children:["ID: ",null==s?void 0:s.slice(-8)]})]}),(0,r.jsx)("button",{onClick:()=>{navigator.clipboard.writeText("".concat(window.location.origin,"/browse")),alert("Browse link copied!")},className:"w-full bg-blue-500 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-600 transition-colors mb-6",children:"\uD83D\uDCCB Copy Browse Link for Guests"}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("h3",{className:"font-bold text-lg text-gray-800 mb-3",children:["Participants (",i.length,")"]}),0===i.length?(0,r.jsx)("p",{className:"text-gray-500 text-center py-4",children:"Waiting for guests..."}):(0,r.jsx)("div",{className:"flex flex-wrap gap-2",children:i.map(e=>(0,r.jsxs)("div",{className:"bg-gradient-to-r from-purple-500 to-indigo-600 text-white px-4 py-2 rounded-full font-semibold text-sm",children:[e.isHost?"\uD83C\uDFA4":"\uD83D\uDC65"," ",e.username]},e.userId))})]})]})]}),(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-6 flex flex-col h-[600px] md:h-[750px]",children:[(0,r.jsx)("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:"\uD83D\uDCAC Chat"}),(0,r.jsxs)("div",{className:"flex-1 overflow-y-auto mb-4 space-y-3 pr-2",children:[0===d.length?(0,r.jsx)("p",{className:"text-gray-500 text-center text-sm",children:"No messages yet. Start chatting!"}):d.map((e,t)=>(0,r.jsxs)("div",{className:"text-sm",children:[(0,r.jsxs)("div",{className:"flex items-baseline gap-2",children:[(0,r.jsxs)("span",{className:"font-bold text-purple-600",children:[e.isHost?"\uD83C\uDFA4":""," ",e.username]}),(0,r.jsx)("span",{className:"text-xs text-gray-400",children:new Date(e.timestamp).toLocaleTimeString()})]}),(0,r.jsx)("p",{className:"text-gray-700 ml-4 break-words",children:e.message})]},t)),(0,r.jsx)("div",{ref:k})]}),(0,r.jsxs)("form",{onSubmit:e=>{e.preventDefault(),x.trim()&&s&&(o.W.emit("chat:message",{roomId:s,message:x}),m(""))},className:"flex gap-2 border-t pt-4",children:[(0,r.jsx)("input",{type:"text",value:x,onChange:e=>m(e.target.value),placeholder:"Type a message...",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-purple-500"}),(0,r.jsx)("button",{type:"submit",className:"bg-purple-600 text-white px-3 py-2 rounded-lg hover:bg-purple-700 transition-colors text-sm font-bold",children:"Send"})]})]})]})]}):(0,r.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-purple-600 via-purple-700 to-indigo-800 flex items-center justify-center px-4",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-xl p-8 max-w-md w-full",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-gray-800 mb-6",children:"\uD83C\uDFA4 Start Broadcasting"}),y&&(0,r.jsx)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:y}),(0,r.jsxs)("form",{onSubmit:t=>{if(t.preventDefault(),!e.trim()){w("Please enter a room name");return}o.W.emit("room:create",{roomName:e})},className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-gray-700 font-bold mb-2",children:"Room Name"}),(0,r.jsx)("input",{type:"text",value:e,onChange:e=>t(e.target.value),placeholder:"e.g., My Music Night",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"})]}),(0,r.jsx)("button",{type:"submit",className:"w-full bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700 transition-colors",children:"Create Room"})]})]})})}},4160:function(e,t,s){"use strict";s.d(t,{x:function(){return l}});let r="http://localhost:3001",l={search:async e=>(await fetch("".concat(r,"/api/youtube/search?q=").concat(encodeURIComponent(e)))).json(),getAudio:e=>"".concat(r,"/api/youtube/audio?url=").concat(encodeURIComponent(e))}},1343:function(e,t,s){"use strict";s.d(t,{W:function(){return r}});let r=(0,s(7642).ZP)("http://localhost:3001",{reconnection:!0,reconnectionDelay:1e3,reconnectionDelayMax:5e3,reconnectionAttempts:5,transports:["websocket","polling"]})}},function(e){e.O(0,[642,888,774,179],function(){return e(e.s=2836)}),_N_E=e.O()}]);