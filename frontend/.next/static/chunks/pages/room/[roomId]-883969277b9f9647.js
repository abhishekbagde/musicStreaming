(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[947],{657:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/room/[roomId]",function(){return s(1500)}])},1500:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return i}});var r=s(5893),o=s(7294),n=s(1163),a=s(1343),l=s(4160);function i(){let e=(0,n.useRouter)(),{roomId:t}=e.query,[s,i]=(0,o.useState)([]),[c,d]=(0,o.useState)(""),[u,m]=(0,o.useState)([]),[x,p]=(0,o.useState)([]),[g,h]=(0,o.useState)(null),[f,b]=(0,o.useState)(!1),[j,N]=(0,o.useState)(!1),[v,y]=(0,o.useState)(!1),w=(0,o.useRef)(null),W=(0,o.useRef)(new Float32Array(441e3)),D=(0,o.useRef)(0);return((0,o.useRef)(0),(0,o.useEffect)(()=>{if(!t)return;let s=e.query.username;return a.W.emit("room:join",{roomId:t,username:s}),a.W.on("room:joined",()=>{N(!0),console.log("✅ Joined room:",t)}),a.W.on("participants:list",e=>{var t;let s=(null===(t=e.participants)||void 0===t?void 0:t.map(e=>({userId:e.userId,username:e.username,isHost:e.isHost})))||[];m(s),console.log("\uD83D\uDC65 Participants:",s.length)}),a.W.on("user:joined",e=>{m(t=>t.some(t=>t.userId===e.userId)?t:(console.log("➕ User joined:",e.username),[...t,{userId:e.userId,username:e.username,isHost:e.isHost||!1}]))}),a.W.on("user:left",e=>{console.log("➖ User left:",e.userId),m(t=>t.filter(t=>t.userId!==e.userId))}),a.W.on("broadcast:started",()=>{y(!0),console.log("\uD83D\uDD34 Broadcast started")}),a.W.on("broadcast:audio",e=>{let t=new Float32Array(e.data);for(let e=0;e<t.length;e++)W.current[D.current%W.current.length]=t[e],D.current++}),a.W.on("broadcast:stopped",()=>{y(!1),console.log("⏹️ Broadcast stopped")}),a.W.on("playlist:update",e=>{var t;if(p(e.queue||[]),h(e.currentSong||null),console.log("\uD83C\uDFB5 Queue updated:",(null===(t=e.queue)||void 0===t?void 0:t.length)||0),e.currentSong&&e.playing&&w.current){let t=l.x.getAudio(e.currentSong.url);w.current.src=t,w.current.play().catch(e=>{console.error("Error playing audio:",e)}),b(!0)}}),a.W.on("chat:message",e=>{i(t=>[...t,e])}),a.W.on("room:closed",()=>{alert("Host closed the room"),e.push("/browse")}),()=>{a.W.off("room:joined"),a.W.off("participants:list"),a.W.off("user:joined"),a.W.off("user:left"),a.W.off("broadcast:started"),a.W.off("broadcast:audio"),a.W.off("broadcast:stopped"),a.W.off("playlist:update"),a.W.off("chat:message"),a.W.off("room:closed"),a.W.emit("room:leave")}},[t,e]),j)?(0,r.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-purple-600 via-purple-700 to-indigo-800 p-4",children:[(0,r.jsx)("audio",{ref:w,crossOrigin:"anonymous",onEnded:()=>b(!1)}),(0,r.jsxs)("div",{className:"max-w-5xl mx-auto grid md:grid-cols-3 gap-6",children:[(0,r.jsxs)("div",{className:"md:col-span-2 space-y-6",children:[(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"\uD83C\uDFB5 Music Queue"}),x.length>0&&(0,r.jsx)("div",{className:"mb-6",children:(0,r.jsxs)("div",{className:"bg-gradient-to-r from-purple-500 to-indigo-600 rounded-lg p-6 text-white",children:[(0,r.jsx)("div",{className:"text-sm font-semibold mb-2",children:"NOW PLAYING"}),(0,r.jsx)("div",{className:"text-2xl font-bold mb-2 truncate",children:x[0].title}),(0,r.jsx)("div",{className:"text-purple-100 mb-4 truncate",children:x[0].author})]})}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("h3",{className:"font-bold text-lg text-gray-800 mb-3",children:["Queue (",x.length,")"]}),0===x.length?(0,r.jsxs)("div",{className:"bg-gray-50 rounded-lg p-8 text-center text-gray-500",children:[(0,r.jsx)("div",{className:"text-4xl mb-2",children:"�"}),(0,r.jsx)("p",{children:"Waiting for host to add songs..."})]}):(0,r.jsx)("div",{className:"space-y-2",children:x.map((e,t)=>(0,r.jsxs)("div",{className:"flex items-center gap-3 p-3 rounded-lg transition-colors ".concat(0===t?"bg-purple-100 border-2 border-purple-500":"bg-gray-50 hover:bg-gray-100"),children:[(0,r.jsx)("div",{className:"text-lg font-bold w-8 text-center",children:0===t?"▶️":t}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsx)("div",{className:"font-semibold text-gray-800 truncate",children:e.title}),(0,r.jsx)("div",{className:"text-sm text-gray-500 truncate",children:e.author})]}),(0,r.jsx)("div",{className:"text-sm text-gray-400 flex-shrink-0",children:e.duration||"N/A"})]},e.id))})]})]}),(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[(0,r.jsxs)("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:["Participants (",u.length,")"]}),(0,r.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:u.map(e=>(0,r.jsxs)("div",{className:"bg-purple-100 px-3 py-2 rounded-lg text-purple-700 font-semibold text-center text-sm",children:[e.isHost?"\uD83C\uDFA4":"\uD83D\uDC65"," ",e.username]},e.userId))})]})]}),(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-6 flex flex-col h-[600px] md:h-[700px]",children:[(0,r.jsx)("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:"\uD83D\uDCAC Chat"}),(0,r.jsx)("div",{className:"flex-1 overflow-y-auto mb-4 space-y-3",children:0===s.length?(0,r.jsx)("p",{className:"text-gray-500 text-center text-sm",children:"No messages yet. Say hello!"}):s.map((e,t)=>(0,r.jsxs)("div",{className:"text-sm",children:[(0,r.jsxs)("div",{className:"flex items-baseline gap-2",children:[(0,r.jsxs)("span",{className:"font-bold text-purple-600",children:[e.isHost?"\uD83C\uDFA4":""," ",e.username]}),(0,r.jsx)("span",{className:"text-xs text-gray-400",children:new Date(e.timestamp).toLocaleTimeString()})]}),(0,r.jsx)("p",{className:"text-gray-700 ml-4",children:e.message})]},t))}),(0,r.jsxs)("form",{onSubmit:e=>{e.preventDefault(),c.trim()&&(a.W.emit("chat:message",{roomId:t,message:c}),d(""))},className:"flex gap-2",children:[(0,r.jsx)("input",{type:"text",value:c,onChange:e=>d(e.target.value),placeholder:"Type a message...",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-purple-500"}),(0,r.jsx)("button",{type:"submit",className:"bg-purple-600 text-white px-3 py-2 rounded-lg hover:bg-purple-700 transition-colors text-sm font-bold",children:"Send"})]})]})]})]}):(0,r.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-purple-600 via-purple-700 to-indigo-800 flex items-center justify-center px-4",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"inline-block animate-spin mb-4",children:(0,r.jsx)("div",{className:"w-12 h-12 border-4 border-white border-t-purple-300 rounded-full"})}),(0,r.jsx)("p",{className:"text-white text-lg",children:"Connecting to room..."})]})})}},4160:function(e,t,s){"use strict";s.d(t,{x:function(){return o}});let r="http://localhost:3001",o={search:async e=>(await fetch("".concat(r,"/api/youtube/search?q=").concat(encodeURIComponent(e)))).json(),getAudio:e=>"".concat(r,"/api/youtube/audio?url=").concat(encodeURIComponent(e))}},1343:function(e,t,s){"use strict";s.d(t,{W:function(){return r}});let r=(0,s(7642).ZP)("http://localhost:3001",{reconnection:!0,reconnectionDelay:1e3,reconnectionDelayMax:5e3,reconnectionAttempts:5,transports:["websocket","polling"]})},1163:function(e,t,s){e.exports=s(3079)}},function(e){e.O(0,[642,888,774,179],function(){return e(e.s=657)}),_N_E=e.O()}]);